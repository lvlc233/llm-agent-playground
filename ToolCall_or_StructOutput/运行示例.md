# è¿è¡Œç¤ºä¾‹ä¸CSVæ•°æ®åˆ†æ

## ğŸš€ å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

### ç¯å¢ƒå‡†å¤‡
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd G:\work\project\self_project\Agent_idea\llm-agent-playground\ToolCall_or_StructOutput

# é…ç½®ç¯å¢ƒå˜é‡ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
copy .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„APIå¯†é’¥

# å®‰è£…ä¾èµ–
pip install -e .
```

### è¿è¡Œæ‰€æœ‰å®éªŒ
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨æ¨¡å—æ¨¡å¼ï¼ˆæ¨èï¼‰
python -m src.main

# æ–¹æ³•2ï¼šä½¿ç”¨å¯åŠ¨å™¨
python run_experiments.py
```

### è¿è¡Œç‰¹å®šå®éªŒ
```bash
# ä»…è¿è¡ŒTokenæ¶ˆè€—å®éªŒ
python -m src.main --exp 1

# ä»…è¿è¡Œå¤šå·¥å…·æ‰¹å¤„ç†å®éªŒ
python -m src.main --exp 2

# ä»…è¿è¡Œåˆ†å±‚æ¶æ„å®éªŒ
python -m src.main --exp 3
```

## ğŸ“Š æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹

### å®éªŒ1ï¼šTokenæ¶ˆè€—å¯¹æ¯”
```
==================== å®éªŒæ‘˜è¦ ====================
å®éªŒåç§°: Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”
æ¨¡å‹åç§°: Qwen/Qwen3-30B-A3B-Instruct-2507
æµ‹è¯•æ—¶é—´: 2025-12-04 17:30:45
æ–¹æ³•               | è¾“å…¥Token   | è¾“å‡ºToken   | å»¶è¿Ÿ(ç§’)    | çŠ¶æ€
å·¥å…·è°ƒç”¨            | 156        | 42         | 0.5234     | æˆåŠŸ
ç»“æ„åŒ–è¾“å‡º          | 89         | 31         | 0.3892     | æˆåŠŸ
================================================

è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
å®éªŒåç§°: Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”
æ¨¡å‹åç§°: Qwen/Qwen3-30B-A3B-Instruct-2507
æ€»æµ‹è¯•æ¬¡æ•°: 2
æˆåŠŸæ¬¡æ•°: 2
å¤±è´¥æ¬¡æ•°: 0
æˆåŠŸç‡: 100.0%
å¹³å‡è¾“å…¥Tokenæ•°: 122
å¹³å‡è¾“å‡ºTokenæ•°: 36
å¹³å‡å»¶è¿Ÿ: 0.456ç§’
æ€»Tokenæ¶ˆè€—: 318

å®éªŒç»“æœå·²ä¿å­˜åˆ°: å®éªŒç»“æœ/Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”_20251204_173045.csv
```

### å®éªŒ2ï¼šå¤šå·¥å…·æ‰¹å¤„ç†
```
==================== å®éªŒæ‘˜è¦ ====================
å®éªŒåç§°: å¤šå·¥å…·æ‰¹å¤„ç†æ€§èƒ½å¯¹æ¯”
æ¨¡å‹åç§°: Qwen/Qwen3-30B-A3B-Instruct-2507
æµ‹è¯•æ—¶é—´: 2025-12-04 17:31:15
æ–¹æ³•               | è¾“å…¥Token   | è¾“å‡ºToken   | å»¶è¿Ÿ(ç§’)    | çŠ¶æ€
å·¥å…·è°ƒç”¨æ‰¹å¤„ç†      | 203        | 68         | 0.8923     | æˆåŠŸ
ç»“æ„åŒ–è¾“å‡ºæ‰¹å¤„ç†    | 145        | 52         | 0.6345     | æˆåŠŸ
================================================

å®éªŒç»“æœå·²ä¿å­˜åˆ°: å®éªŒç»“æœ/å¤šå·¥å…·æ‰¹å¤„ç†æ€§èƒ½å¯¹æ¯”_20251204_173115.csv
```

## ğŸ“ CSVæ–‡ä»¶åˆ†æ

### CSVæ–‡ä»¶ç»“æ„
```csv
Experiment Name,Method Name,Model Name,Input Tokens,Output Tokens,Total Tokens,Latency (Seconds),Success,Error Message,Test Time
Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”,å·¥å…·è°ƒç”¨,Qwen/Qwen3-30B-A3B-Instruct-2507,156,42,198,0.5234,Success,,2025-12-04 17:30:45
Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”,ç»“æ„åŒ–è¾“å‡º,Qwen/Qwen3-30B-A3B-Instruct-2507,89,31,120,0.3892,Success,,2025-12-04 17:30:46
```

### ä½¿ç”¨Pythonåˆ†æCSVæ•°æ®

#### åŸºç¡€æ•°æ®åˆ†æ
```python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# è¯»å–CSVæ–‡ä»¶
df = pd.read_csv('å®éªŒç»“æœ/Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”_20251204_173045.csv')

# æ˜¾ç¤ºæ•°æ®æ¦‚è§ˆ
print("æ•°æ®æ¦‚è§ˆ:")
print(df.head())
print(f"\næ•°æ®å½¢çŠ¶: {df.shape}")
print(f"\nç»Ÿè®¡ä¿¡æ¯:\n{df.describe()}")
```

#### Tokenæ¶ˆè€—å¯¹æ¯”åˆ†æ
```python
# Tokenæ¶ˆè€—å¯¹æ¯”
token_comparison = df.groupby('Method Name')[['Input Tokens', 'Output Tokens', 'Total Tokens']].mean()

# å¯è§†åŒ–
token_comparison.plot(kind='bar', figsize=(10, 6))
plt.title('Tokenæ¶ˆè€—å¯¹æ¯” - æŒ‰æ–¹æ³•åˆ†ç»„', fontsize=14)
plt.xlabel('æ–¹æ³•', fontsize=12)
plt.ylabel('å¹³å‡Tokenæ•°', fontsize=12)
plt.legend(['è¾“å…¥Token', 'è¾“å‡ºToken', 'æ€»Tokenæ•°'])
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
```

#### å»¶è¿Ÿæ€§èƒ½åˆ†æ
```python
# å»¶è¿Ÿå¯¹æ¯”
plt.figure(figsize=(10, 6))
sns.boxplot(data=df, x='Method Name', y='Latency (Seconds)')
plt.title('å“åº”å»¶è¿Ÿåˆ†å¸ƒå¯¹æ¯”', fontsize=14)
plt.xlabel('æ–¹æ³•', fontsize=12)
plt.ylabel('å»¶è¿Ÿ(ç§’)', fontsize=12)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()
```

#### æˆåŠŸç‡ç»Ÿè®¡
```python
# æˆåŠŸç‡ç»Ÿè®¡
success_rate = df.groupby('Method Name')['Success'].apply(lambda x: (x == 'Success').mean() * 100)

plt.figure(figsize=(8, 6))
success_rate.plot(kind='bar', color=['skyblue', 'lightcoral'])
plt.title('æˆåŠŸç‡å¯¹æ¯”', fontsize=14)
plt.xlabel('æ–¹æ³•', fontsize=12)
plt.ylabel('æˆåŠŸç‡(%)', fontsize=12)
plt.xticks(rotation=45)
plt.ylim(0, 105)
for i, v in enumerate(success_rate.values):
    plt.text(i, v + 1, f'{v:.1f}%', ha='center', va='bottom')
plt.tight_layout()
plt.show()
```

### å¤šå®éªŒæ•°æ®åˆå¹¶åˆ†æ

#### æ‰¹é‡è¯»å–å¤šä¸ªCSVæ–‡ä»¶
```python
import glob
import os

# è·å–æ‰€æœ‰CSVæ–‡ä»¶
csv_files = glob.glob('å®éªŒç»“æœ/*.csv')

# åˆå¹¶æ‰€æœ‰æ•°æ®
all_data = []
for file in csv_files:
    df_temp = pd.read_csv(file)
    all_data.append(df_temp)

# åˆå¹¶æ•°æ®æ¡†
df_combined = pd.concat(all_data, ignore_index=True)

# æŒ‰å®éªŒç±»å‹åˆ†æ
experiment_summary = df_combined.groupby(['Experiment Name', 'Method Name']).agg({
    'Total Tokens': 'mean',
    'Latency (Seconds)': 'mean',
    'Success': lambda x: (x == 'Success').mean() * 100
}).round(3)

print("å¤šå®éªŒç»¼åˆç»Ÿè®¡:")
print(experiment_summary)
```

#### ç”Ÿæˆç»¼åˆæŠ¥å‘Š
```python
# åˆ›å»ºç»¼åˆæ€§èƒ½æŠ¥å‘Š
fig, axes = plt.subplots(2, 2, figsize=(15, 12))

# 1. Tokenæ¶ˆè€—å¯¹æ¯”
experiment_summary['Total Tokens'].unstack().plot(kind='bar', ax=axes[0,0])
axes[0,0].set_title('å„å®éªŒTokenæ¶ˆè€—å¯¹æ¯”', fontsize=12)
axes[0,0].set_ylabel('å¹³å‡æ€»Tokenæ•°')
axes[0,0].tick_params(axis='x', rotation=45)

# 2. å»¶è¿Ÿå¯¹æ¯”
experiment_summary['Latency (Seconds)'].unstack().plot(kind='bar', ax=axes[0,1])
axes[0,1].set_title('å„å®éªŒå“åº”å»¶è¿Ÿå¯¹æ¯”', fontsize=12)
axes[0,1].set_ylabel('å¹³å‡å»¶è¿Ÿ(ç§’)')
axes[0,1].tick_params(axis='x', rotation=45)

# 3. æˆåŠŸç‡å¯¹æ¯”
experiment_summary['Success'].unstack().plot(kind='bar', ax=axes[1,0])
axes[1,0].set_title('å„å®éªŒæˆåŠŸç‡å¯¹æ¯”', fontsize=12)
axes[1,0].set_ylabel('æˆåŠŸç‡(%)')
axes[1,0].tick_params(axis='x', rotation=45)

# 4. æ–¹æ³•æ€§èƒ½é›·è¾¾å›¾
from math import pi

categories = ['Token Efficiency', 'Speed', 'Success Rate']
tool_call_scores = [
    100,  # Tokenæ•ˆç‡ç›¸å¯¹å€¼
    100,  # é€Ÿåº¦ç›¸å¯¹å€¼
    experiment_summary.loc[('Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”', 'å·¥å…·è°ƒç”¨'), 'Success']
]
struct_scores = [
    150,  # Tokenæ•ˆç‡ç›¸å¯¹å€¼
    130,  # é€Ÿåº¦ç›¸å¯¹å€¼
    experiment_summary.loc[('Tokenæ¶ˆè€—ä¸åŸºç¡€æå–å¯¹æ¯”', 'ç»“æ„åŒ–è¾“å‡º'), 'Success']
]

angles = [n / float(len(categories)) * 2 * pi for n in range(len(categories))]
angles += angles[:1]

tool_call_scores += tool_call_scores[:1]
struct_scores += struct_scores[:1]

ax = axes[1,1]
ax.plot(angles, tool_call_scores, 'o-', linewidth=2, label='å·¥å…·è°ƒç”¨', color='blue')
ax.fill(angles, tool_call_scores, alpha=0.25, color='blue')
ax.plot(angles, struct_scores, 'o-', linewidth=2, label='ç»“æ„åŒ–è¾“å‡º', color='red')
ax.fill(angles, struct_scores, alpha=0.25, color='red')

ax.set_xticks(angles[:-1])
ax.set_xticklabels(categories)
ax.set_ylim(0, 160)
ax.set_title('æ–¹æ³•æ€§èƒ½é›·è¾¾å›¾', fontsize=12)
ax.legend()
ax.grid(True)

plt.tight_layout()
plt.show()
```

## ğŸ“ˆ æ€§èƒ½åˆ†æå»ºè®®

### 1. å…³é”®æŒ‡æ ‡å¯¹æ¯”
```python
# è®¡ç®—å…³é”®æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”
performance_metrics = df.groupby('Method Name').agg({
    'Total Tokens': ['mean', 'std'],
    'Latency (Seconds)': ['mean', 'std'],
    'Success': lambda x: (x == 'Success').mean()
}).round(4)

print("æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”:")
print(performance_metrics)
```

### 2. æˆæœ¬æ•ˆç›Šåˆ†æ
```python
# å‡è®¾æ¯1000 tokensçš„æˆæœ¬
cost_per_1k_tokens = 0.01  # ç¾å…ƒ

# è®¡ç®—æ¯æ¬¡è°ƒç”¨çš„å¹³å‡æˆæœ¬
cost_analysis = df.groupby('Method Name')['Total Tokens'].apply(
    lambda x: (x / 1000) * cost_per_1k_tokens
).mean()

print("æˆæœ¬åˆ†æ (å‡è®¾$0.01/1K tokens):")
for method, cost in cost_analysis.items():
    print(f"{method}: ${cost:.6f} æ¯æ¬¡è°ƒç”¨")
```

### 3. ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ
```python
from scipy import stats

# æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„Tokenæ¶ˆè€—
tool_call_tokens = df[df['Method Name'] == 'å·¥å…·è°ƒç”¨']['Total Tokens']
struct_tokens = df[df['Method Name'] == 'ç»“æ„åŒ–è¾“å‡º']['Total Tokens']

# Tæ£€éªŒ
t_stat, p_value = stats.ttest_ind(tool_call_tokens, struct_tokens)

print(f"Tokenæ¶ˆè€—Tæ£€éªŒç»“æœ:")
print(f"Tç»Ÿè®¡é‡: {t_stat:.4f}")
print(f"På€¼: {p_value:.4f}")
print(f"æ˜¾è‘—æ€§: {'æ˜¾è‘—' if p_value < 0.05 else 'ä¸æ˜¾è‘—'}")
```

## ğŸ“ å®éªŒæŠ¥å‘Šç”Ÿæˆ

### è‡ªåŠ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š
```python
import datetime

def generate_report(df_list, output_file='å®éªŒæŠ¥å‘Š.md'):
    """ç”ŸæˆMarkdownæ ¼å¼çš„å®éªŒæŠ¥å‘Š"""

    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(f"# å®éªŒåˆ†ææŠ¥å‘Š\n")
        f.write(f"ç”Ÿæˆæ—¶é—´: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")

        for i, df in enumerate(df_list):
            exp_name = df['Experiment Name'].iloc[0]
            f.write(f"## å®éªŒ{i+1}: {exp_name}\n")

            # åŸºæœ¬ç»Ÿè®¡
            summary = df.groupby('Method Name').agg({
                'Total Tokens': 'mean',
                'Latency (Seconds)': 'mean',
                'Success': lambda x: (x == 'Success').mean()
            }).round(4)

            f.write("### æ€§èƒ½æŒ‡æ ‡\n")
            f.write(summary.to_markdown())
            f.write("\n")

            # å…³é”®å‘ç°
            best_method = summary['Total Tokens'].idxmin()
            f.write(f"### å…³é”®å‘ç°\n")
            f.write(f"- Tokenæ•ˆç‡æœ€ä½³: {best_method}\n")
            f.write(f"- å¹³å‡TokenèŠ‚çœ: {summary.loc['å·¥å…·è°ƒç”¨', 'Total Tokens'] - summary.loc['ç»“æ„åŒ–è¾“å‡º', 'Total Tokens']:.1f}\n")
            f.write("\n")

# ç”ŸæˆæŠ¥å‘Š
generate_report([df_combined])
print("å®éªŒæŠ¥å‘Šå·²ç”Ÿæˆ: å®éªŒæŠ¥å‘Š.md")
```

## ğŸ”§ æ•…éšœæ’é™¤

### CSVæ–‡ä»¶è¯»å–é—®é¢˜
```python
# å¤„ç†ç¼–ç é—®é¢˜
try:
    df = pd.read_csv('å®éªŒç»“æœ/xxx.csv', encoding='utf-8')
except UnicodeDecodeError:
    df = pd.read_csv('å®éªŒç»“æœ/xxx.csv', encoding='gbk')

# å¤„ç†ç¼ºå¤±å€¼
df = df.fillna('')

# æ•°æ®ç±»å‹è½¬æ¢
df['Latency (Seconds)'] = pd.to_numeric(df['Latency (Seconds)'], errors='coerce')
```

### å¯è§†åŒ–ä¸­æ–‡é—®é¢˜
```python
# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']  # Mac
plt.rcParams['axes.unicode_minus'] = False  # è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜
```

## ğŸ“Š æœ€ä½³å®è·µå»ºè®®

1. **å®šæœŸå¤‡ä»½**: å®šæœŸå¤‡ä»½`å®éªŒç»“æœ`ç›®å½•
2. **ç‰ˆæœ¬æ§åˆ¶**: åœ¨CSVæ–‡ä»¶åä¸­åŒ…å«æ¨¡å‹ç‰ˆæœ¬ä¿¡æ¯
3. **æ‰¹é‡åˆ†æ**: ç§¯ç´¯å¤šä¸ªå®éªŒæ•°æ®åè¿›è¡Œæ‰¹é‡åˆ†æ
4. **å¯¹æ¯”åŸºå‡†**: å»ºç«‹æ€§èƒ½åŸºå‡†ï¼Œè·Ÿè¸ªå˜åŒ–è¶‹åŠ¿
5. **å¼‚å¸¸æ£€æµ‹**: è®¾ç½®æ€§èƒ½é˜ˆå€¼ï¼Œè‡ªåŠ¨æ£€æµ‹å¼‚å¸¸æ•°æ®

---

**æœ€åæ›´æ–°**: 2025å¹´12æœˆ
**ç¤ºä¾‹ç‰ˆæœ¬**: v2.0 - åŒ…å«CSVæŒä¹…åŒ–å’Œä¸­æ–‡è¾“å‡ºç‰¹æ€§